---
// Componente WhatsappButton - Botón flotante de WhatsApp con datos de Sanity
import { sanityFetch } from "../lib/sanity";

const config = await sanityFetch(`
  *[_type == "configuracion"][0]{
    whatsapp
  }
`);

const numero = config?.whatsapp?.numero?.replace(/\+/g, "") || "12345679";
const mensaje = encodeURIComponent(
  config?.whatsapp?.mensajePredeterminado ||
    "Hola! Me interesan sus productos tejidos",
);
const href = `https://wa.me/${numero}?text=${mensaje}`;
---

<div
  class="fixed bottom-6 right-4 sm:bottom-8 sm:right-6 md:bottom-10 md:right-8 z-50 flex items-center group"
>
  <!-- Tooltip Message -->
  <div
    class="absolute right-[calc(100%+12px)] px-4 py-2.5 bg-white text-gray-800 text-sm font-semibold rounded-2xl shadow-xl opacity-0 translate-x-4 invisible group-hover:opacity-100 group-hover:translate-x-0 group-hover:visible transition-all duration-300 pointer-events-none whitespace-nowrap border-2 border-green-50 hidden sm:block"
  >
    ¿Te ayudo con tu pedido?
    <div
      class="absolute top-1/2 -right-1.5 -translate-y-1/2 w-3 h-3 bg-white rotate-45 border-t-2 border-r-2 border-green-50 rounded-tr-[2px]"
    >
    </div>
  </div>

  <!-- Pulsing Animation Ring -->
  <div class="absolute inset-0 bg-[#25D366] rounded-full animate-ping-interval">
  </div>

  <!-- Main Button Container for Drop Shadow -->
  <div
    class="relative drop-shadow-[0_4px_16px_rgba(37,211,102,0.4)] transition-all duration-300 group-hover:drop-shadow-[0_8px_24px_rgba(37,211,102,0.6)] animate-vibrate-interval"
  >
    <a
      href={href}
      target="_blank"
      rel="noopener noreferrer"
      aria-label="Contactanos por WhatsApp"
      class="flex items-center justify-center bg-linear-to-br from-[#25D366] to-[#1DA851] hover:from-[#1DA851] hover:to-[#128C7E] active:scale-95 text-white rounded-[1.25rem] sm:rounded-3xl p-3.5 sm:p-4 transition-all duration-300 transform group-hover:scale-[1.08] hover:-rotate-2"
    >
      <img
        src="/whatsappIcon.svg"
        alt=""
        aria-hidden="true"
        class="w-6 h-6 sm:w-7 sm:h-7 opacity-95 group-hover:opacity-100 transition-opacity"
      />
    </a>
  </div>
</div>

<style>
  @keyframes vibrate-interval {
    0%,
    98.33% {
      transform: translate(0) rotate(0);
    }
    98.5% {
      transform: translate(-2px, 2px) rotate(-3deg);
    }
    98.83% {
      transform: translate(2px, -2px) rotate(3deg);
    }
    99.16% {
      transform: translate(-2px, -2px) rotate(-3deg);
    }
    99.5% {
      transform: translate(2px, 2px) rotate(3deg);
    }
    99.83% {
      transform: translate(-1px, 1px) rotate(-1deg);
    }
    100% {
      transform: translate(0) rotate(0);
    }
  }

  .animate-vibrate-interval {
    animation: vibrate-interval 60s ease-in-out infinite;
  }

  @keyframes ping-interval {
    0% {
      transform: scale(1);
      opacity: 0.7;
    }
    6.66%,
    100% {
      transform: scale(2);
      opacity: 0;
    }
  }

  .animate-ping-interval {
    animation: ping-interval 15s cubic-bezier(0, 0, 0.2, 1) infinite;
  }
</style>
